<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Correlating Variables in Your Model · MCHammer.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><a href="../../index.html"><img class="logo" src="../../assets/logo.png" alt="MCHammer.jl logo"/></a><h1>MCHammer.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../">MCHammer.jl</a></li><li><a class="toctext" href="../../manual/1_functions/">Simulation Modeling Functions</a></li><li><a class="toctext" href="../../manual/charts/">Charting Functions</a></li><li><a class="toctext" href="../../manual/time_series/">Time-Series Simulation</a></li><li><a class="toctext" href="../1_first_model/">Building your first model</a></li><li class="current"><a class="toctext" href>Correlating Variables in Your Model</a><ul class="internal"><li><a class="toctext" href="#Building-a-Simple-Uncorrelated-Model-1">Building a Simple Uncorrelated Model</a></li><li><a class="toctext" href="#Applying-correlation-to-your-simulation-1">Applying correlation to your simulation</a></li><li><a class="toctext" href="#Analyze-the-impact-of-correlation-on-your-output-1">Analyze the impact of correlation on your output</a></li><li><a class="toctext" href="#Correlated-vs.-Uncorrelated-results-in-Julia-1">Correlated vs. Uncorrelated results in Julia</a></li><li><a class="toctext" href="#A-quick-analysis-of-the-results-1">A quick analysis of the results</a></li></ul></li><li><a class="toctext" href="../3_NPV_testmodel/">Simulated NPV with Time-Series</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Correlating Variables in Your Model</a></li></ul><a class="edit-page" href="github.com/etorkia/MCHammer.jl"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Correlating Variables in Your Model</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Correlating-Variables-in-Your-Model-1" href="#Correlating-Variables-in-Your-Model-1">Correlating Variables in Your Model</a></h1><p>To get started, we are going to recap what we did in your first model and build a correlated version of the same model and compare.</p><h2><a class="nav-anchor" id="Building-a-Simple-Uncorrelated-Model-1" href="#Building-a-Simple-Uncorrelated-Model-1">Building a Simple Uncorrelated Model</a></h2><pre><code class="language-">using Distributions, StatsBase, DataFrames, MCHammer
n_trials = 10000
Revenue = rand(TriangularDist(2500000,4000000,3000000), n_trials)
Expenses = rand(TriangularDist(1400000,3000000,2000000), n_trials)

# The Model
Profit = Revenue - Expenses

#Trial Results : the Profit vector (OUTPUT)
Profit

# Trials or Results Table (OUTPUT)
Trials = hcat(Profit, Revenue, Expenses)
Trials = DataFrame(Trials)
names!(Trials, [:Profit, :Revenue, :Expenses])

cormat(Trials)</code></pre><h2><a class="nav-anchor" id="Applying-correlation-to-your-simulation-1" href="#Applying-correlation-to-your-simulation-1">Applying correlation to your simulation</a></h2><p>Using the <code>corvar()</code> function, we are going to correlate the Revenue and Expenses at -0.8 and generate the results tables for both the correlated and uncorrelated versions.</p><pre><code class="language-julia">#Apply correlation to random samples
Rev_Exp_Cor = 0.8
cor_matrix = [1 Rev_Exp_Cor; Rev_Exp_Cor 1]

#Validate input correlation. You can also use cormat() to define the correlation
#matrix from historical data.
cor_matrix</code></pre><pre><code class="language-none">2×2 Array{Float64,2}:
 1.0  0.8
 0.8  1.0</code></pre><p>It is very important to join Trial into an array before applying correlation. Furthermore, this step is necessary in order to produce a <code>sensitivity_chrt()</code></p><pre><code class="language-">c_table = [Revenue Expenses]
C_Trials = corvar(c_table, n_trials, cor_matrix)

#Correlated Model(2) - Create Correlated Results Array
C_Profit = C_Trials[1] - C_Trials[2]
C_Trials = [C_Profit, C_Trials[1], C_Trials[2]]
C_Trials = DataFrame(C_Trials)
names!(C_Trials, [:C_Profit, :C_Revenue, :C_Expenses])

cormat(C_Trials)
</code></pre><h2><a class="nav-anchor" id="Analyze-the-impact-of-correlation-on-your-output-1" href="#Analyze-the-impact-of-correlation-on-your-output-1">Analyze the impact of correlation on your output</a></h2><h3><a class="nav-anchor" id="Input-Correlation-between-Revenue-and-Expenses-1" href="#Input-Correlation-between-Revenue-and-Expenses-1">Input Correlation between Revenue and Expenses</a></h3><p>Input Correlation:</p><pre><code class="language-">cor(Revenue,Expenses)</code></pre><p>Input Correlation for the Correlated Model:</p><pre><code class="language-">cor(C_Trials[2],C_Trials[3])</code></pre><p>Make sure to put a line in your project that lists all the outputs you can query with the charting and stats functions.</p><pre><code class="language-">println(&quot;Model Outputs: Trials, C_Trials, Profit, C_Profit&quot;)</code></pre><h2><a class="nav-anchor" id="Correlated-vs.-Uncorrelated-results-in-Julia-1" href="#Correlated-vs.-Uncorrelated-results-in-Julia-1">Correlated vs. Uncorrelated results in Julia</a></h2><p>Let us compare the percentiles of an uncorrelated  model vs. a correlated one.</p><h3><a class="nav-anchor" id="Uncorrelated-Results-1" href="#Uncorrelated-Results-1">Uncorrelated Results</a></h3><pre><code class="language-">density_chrt(Profit)</code></pre><p>Probability of Making 1m or less (uncorrelated) :</p><pre><code class="language-">GetCertainty(Profit, 1000000, 0)</code></pre><p><code>fractiles()</code> allows you to get the percentiles at various increments.</p><pre><code class="language-">fractiles(Profit)</code></pre><pre><code class="language-">sensitivity_chrt(Trials,1)</code></pre><h3><a class="nav-anchor" id="Correlated-Results-1" href="#Correlated-Results-1">Correlated Results</a></h3><pre><code class="language-">density_chrt(C_Profit)</code></pre><p>Probability of Making 1m or less (correlated) :</p><pre><code class="language-">GetCertainty(C_Profit, 1000000, 0)</code></pre><pre><code class="language-">fractiles(C_Profit)</code></pre><pre><code class="language-">sensitivity_chrt(C_Trials,1)</code></pre><h2><a class="nav-anchor" id="A-quick-analysis-of-the-results-1" href="#A-quick-analysis-of-the-results-1">A quick analysis of the results</a></h2><ol><li><p>Accounting for correlation meant a 5% (42.5% vs. 47.7%) reduction in probability of not making our goals.</p></li><li><p>The Worse Case goes from -290k to 230k, a 225% difference</p></li><li><p>The critical driver in both cases is expenses.</p></li></ol><footer><hr/><a class="previous" href="../1_first_model/"><span class="direction">Previous</span><span class="title">Building your first model</span></a><a class="next" href="../3_NPV_testmodel/"><span class="direction">Next</span><span class="title">Simulated NPV with Time-Series</span></a></footer></article></body></html>
